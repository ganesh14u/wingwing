"use strict";(self.webpackChunkFusion=self.webpackChunkFusion||[]).push([[82865],{42545:(e,t,r)=>{r.d(t,{op:()=>d,ZP:()=>u});var n=r(66493),s=r(11573),a=r(33480),o=r(11137);const i=Object.freeze({android:"android",ios:"ios"});var c=r(93649);const u=n.Z,d={isPreCheckoutRequired:c.a_,isEmbeddedInUberApp:function(e){if(e){if(o.window?.webkit?.messageHandlers[e])return{isEmbedded:!0,bridge:o.window?.webkit?.messageHandlers[e],os:i.ios};if(o.window?.[e])return{isEmbedded:!0,bridge:o.window?.[e],os:i.android}}return{isEmbedded:!1}},getEmbedMode:c.IO};a.j,s.T},96726:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(91931),s=r(79857),a=r(59924);const o=(0,n.zo)("div",(e=>({display:"flex",flexDirection:"column",height:"100%",position:"relative",marginTop:e.$embedded?"0px":"64px"}))),i=e=>{const t=(0,s.Z)();return(0,a.tZ)(o,{$embedded:t?1:0,children:e.children})}},40506:(e,t,r)=>{r.d(t,{Z:()=>A});var n=r("__fusion__476"),s=r(74369),a=r(69420),o=r(94813),i=r(89151),c=r(52481),u=r(14005),d=r(34626),l=r(79851),m=r(47986),p=r(33535),P=r(21585),h=r(81077),f=r(88499),y=r(51901),_=r(32135),b=r(54176),C=r(37998),N=r(46938),E=r(5639),Z=r(59924);const A=e=>{const{cardScreenPresentationData:t,membershipAnalyticsMeta:r,setPurchaseError:A,onPurchaseSuccess:O}=e,{purchaseEatsPass:U,purchaseEatsPassMaybe:k,eatsPassSelectedPersonalPayment:g,NoSelectedPaymentProfileError:S,successScreen:M,setSuccessScreen:v}=(0,u.C)(),w=(0,y.Z)({fallback:t}),{getUser:x}=(0,d.Z)(),[K,R]=n.useState(!1),T=(0,l.Z)(),I=(0,a.k6)(),W=(0,o.TH)(),{membershipEntryPoint:q,accessPoint:D,passCampaign:H}=(0,m.RAN)(W,["membershipEntryPoint","accessPoint","passCampaign"]),{getFeed:B}=(0,b.Z)(),L=(0,p.ZP)(),{data:$,refetch:F}=(0,P.I)({},{queryObserverOptions:{enabled:!1}}),j=(0,h.jw)(W),z=(0,i.useQueryClient)(),Y=(0,E.hU)(),V=(0,C.Z)(),[G,Q]=n.useState(null),X=n.useCallback((()=>{A(null)}),[A]),J=(0,s.useCallback)((e=>{const{passOfferUuid:t,passOfferMutationUuid:r,successAction:n,offeringBundleUuid:s,skipPaymentRequirement:a}=e;if(!g&&!a)return void A(S);const o=(0,h.Cd)(n?.data);if(o&&v({type:"membershipCardScreenPresentation",membershipCardScreenPresentation:o}),!k.isLoading&&t&&(g||a)){A(null);const n={passOfferUuid:t,paymentProfileUuid:g?.uuid??"",...r&&{passOfferMutationUuid:r},...s&&{offeringBundleUuid:s}};if(g&&V(g)){const t={defaultPaymentProfile:{currencyAmount:{amountE5:e.paymentAuthenticationData?.totalPrice?.amountE5,currencyCode:e.paymentAuthenticationData?.totalPrice?.currencyCode},paymentProfileUUID:g.uuid,priceStatus:e.paymentAuthenticationData?.totalPriceStatus,paymentProfile:g},useCredits:!1};Q((0,Z.tZ)(N.Z,{request:n,estimatedPaymentPlan:t,onSuccess:e=>Q(null),onError:e=>Q(null),onCancel:()=>Q(null)}))}else U(n);L("eats:membership_purchase_screen_checkout",{resolution:Y.isMobile?_.iw.MOBILE:_.iw.DESKTOP,membership:{entryPoint:q||_.xr.UNKNOWN,accessPoint:D||q||_.xr.UNKNOWN,passCampaign:H||_.xn.UNKNOWN}})}}),[g,k.isLoading,A,S,v,L,q,D,H,U,V,Y.isMobile]),ee=n.useCallback((()=>{if(B({shouldBustCache:!0}),!K)if(R(!0),x({shouldGetSubsMetadata:!0}),z.invalidateQueries(["getMembershipHubV1"]),$&&F(),M)O?O():I.replace(j);else{const e=(0,m.W57)(W,T);I.replace(e)}L("eats:membership_purchase_success",{membership:{entryPoint:q||_.xr.UNKNOWN,accessPoint:D||q||_.xr.UNKNOWN,passCampaign:H||_.xn.UNKNOWN}})}),[K,x,z,$,M,L,q,D,H,F,O,I,j,W,T,B]),te={onUpdateCards:X,onPurchaseMembership:J};n.useEffect((()=>{t&&!w&&L("eats:membership_purchase_screen_view",{membership:{entryPoint:q||_.xr.UNKNOWN,accessPoint:D||q||_.xr.UNKNOWN,passCampaign:H||_.xn.UNKNOWN}})}),[D,t,L,w,q,H]);const re=n.useCallback((e=>{A(e),L("eats:membership_purchase_error",{error:e,membership:{entryPoint:q||_.xr.UNKNOWN,accessPoint:D||q||_.xr.UNKNOWN,passCampaign:H||_.xn.UNKNOWN}})}),[A,L,q,D,H]);return n.useEffect((()=>{k.data?ee():k.error&&re(k.error)}),[k.data,k.error,ee,re]),(0,f.Z)("OFFER_SELECTION_SCREEN",r),(0,Z.BX)(Z.HY,{children:[(0,Z.tZ)(c.Z,{cardScreen:w,cardActionHandlers:te}),G]})}},46938:(e,t,r)=>{r.d(t,{Z:()=>u});var n=r("__fusion__476"),s=r(96188),a=r(14005),o=r(65602),i=r(16690),c=r(59924);const u=e=>{let{request:t,estimatedPaymentPlan:r,onSuccess:u,onError:d,onCancel:l}=e;const{purchaseEatsPass:m,purchaseEatsPassMaybe:p}=(0,a.C)(),[P,h]=n.useState(!1),{orderActionParams:f,onActionsComplete:y,onError:_}=(0,s.Z)({onActionsComplete:e=>{p.isLoading||(m({...t,checkoutActionResultParams:e}),h(!0))},onError:d});return n.useEffect((()=>{P&&(p.data?u(p.data):p.error&&_(p.error))}),[p.data,p.error,P,u,_]),(0,c.tZ)(i.Z,{useCaseKey:o.PH,estimatedPaymentPlan:r,orderActionParams:f,onActionsComplete:y,onCancel:l})}},16690:(e,t,r)=>{r.d(t,{Z:()=>b});var n=r("__fusion__476"),s=r(69420),a=r(14005),o=r(94813),i=r(47986),c=r(1795),u=r(3064),d=r(76892),l=r(75161),m=r(56899),p=r(96726),P=r(70305),h=r(5639),f=r(59924);function y(e){const{isMobile:t}=(0,h.hU)();return(0,f.tZ)(l.u_,{size:t?m.NO.full:void 0,onClose:e.onClose,$isBackgroundTransparent:e.isBackgroundTransparent,children:t?(0,f.tZ)(p.Z,{children:e.children}):(0,f.tZ)(P.Z,{$style:{width:"100%"},children:e.children})})}var _=r(33535);function b(e){let{useCaseKey:t,estimatedPaymentPlan:r,orderActionParams:l,onActionsComplete:m,onCancel:p}=e;const P=(0,s.k6)(),h=(0,o.TH)(),b=(0,_.ZP)(),{allowedEatsPassPaymentTypes:C}=(0,a.C)(),[N,E]=n.useState(!0);n.useEffect((()=>{b("eats:membership_checkout_actions_flow_started",{paymentProfileUUID:r.defaultPaymentProfile.paymentProfileUUID})}),[b,r]);return(0,f.tZ)(y,{isBackgroundTransparent:N,onClose:p,children:null===l?(0,f.tZ)(c.Z,{}):(0,f.tZ)(u.ZP,{selectedPaymentProfile:r.defaultPaymentProfile.paymentProfile,useCaseKey:t,estimatedPaymentPlan:r,orderActionParams:l,onActionsComplete:m,onCancel:p,onNeedsDisplay:E,onSwitchPaymentMethod:e=>{switch(e){case"add_payment_profile":return void(()=>{const e=(0,i.$B7)(h,{modalContext:(0,i.nmv)({allowedPaymentMethods:C,entryPoint:d.X$.membership_personal})});P.push(e)})();case"switch_payment_profile":default:return void(()=>{const e=(0,i._RR)(h,{modalContext:(0,i.nmv)({allowedPaymentMethods:C,entryPoint:d.X$.membership_personal})});P.push(e)})()}}})})}},96188:(e,t,r)=>{r.d(t,{Z:()=>a});var n=r("__fusion__476");Object.freeze({"order_checkout.invalid_order_status":"order_checkout.invalid_order_status"});const s=Object.freeze({"order_checkout.checkout_actions_required":"order_checkout.checkout_actions_required"});function a(e){const t=n.useRef(!1),[r,a]=n.useState();return{orderActionParams:r,onActionsComplete:r=>{t.current||(a(null),t.current=!0,e.onActionsComplete(r))},onError:r=>{!function(e){return e?.meta?.code===s["order_checkout.checkout_actions_required"]}(r)?e.onError(r):(a(r.meta.actionParameters),t.current=!1)}}}},37998:(e,t,r)=>{r.d(t,{Z:()=>a,k:()=>s});var n=r(53043);const s={TRANSITION:"TRANSITION",RENEW:"RENEW",PURCHASE:"PURCHASE"};function a(){return(e,t)=>[n.n.APPLE_PAY_DISPLAY,n.n.BRAINTREE,n.n.GOOGLE_PAY,n.n.PAYPAL].includes(e.tokenType||"")}},21585:(e,t,r)=>{r.d(t,{I:()=>o});var n=r(89151),s=r(2237),a=r(62459);function o(e,t){const r=(0,a.Z)("getMembershipManagementMenuV1"),o=(0,s.H)("getMembershipManagementMenuV1",e);return(0,n.useQuery)({queryKey:o,queryFn:e=>{let{queryKey:t}=e;return r.request("getMembershipManagementMenuV1",t[1])},...t?.queryObserverOptions})}}}]);