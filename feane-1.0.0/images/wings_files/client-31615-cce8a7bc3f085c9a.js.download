"use strict";(self.webpackChunkFusion=self.webpackChunkFusion||[]).push([[31615],{36956:(e,r,t)=>{t.d(r,{Z:()=>U});var i=t(33535),a=t(15070),n=t(65717),o=t(62459),s=t(15473),l=t(89151),u=t(74369),d=t(2237);var p=t(34626),c=t(82600),f=t(88631);const y=e=>{let{selectedBusinessProfile:r,preferredPaymentProfileUuid:t}=e;const{type:i="",defaultPaymentProfileUuid:a}=r||{};return i===f.Hu.Personal?t:a},U=()=>{const e="xlb_synced_profile_event",r=(0,n.Z)(),{isXlbProfileSyncEnabled:t,isLastSelectedProfileEnabled:f,isGetProfilesForUserEnabled:U}=(0,s.Z)(),P=(0,i.I0)(),{profileUUID:m,profileType:D}=(0,a.v)((e=>{let{xlb:r}=e;return r})),{user:I}=(0,p.Z)(),{paymentProfileUuid:O}=(0,c.Z)(),b=I.data?.isLoggedIn,_=(0,o.Z)("getBusinessProfilesV1"),{data:{selectedProfile:g,defaultBusinessProfileUUID:h}={}}=function(e,r){const t=(0,o.Z)("getProfilesForUserV1"),i=(0,d.H)("getProfilesForUserV1",e);return(0,l.useQuery)({queryKey:i,queryFn:e=>{let{queryKey:r}=e;return t.request("getProfilesForUserV1",r[1])},...r?.queryObserverOptions})}({},{queryObserverOptions:{enabled:b&&U}}),v=(0,l.useQuery)("getBusinessProfilesV1",(()=>_.request("getBusinessProfilesV1",null)),{enabled:Boolean(m)}),{selectedBusinessProfile:T,profileSource:C}=(0,u.useMemo)((()=>{if(v?.data){if(r&&m){const r=v?.data?.find((e=>e?.uuid===m));if(r){if(t())return P("eats:xlb_synced_profile_found",{profileType:r?.type,profileUUID:r?.uuid},e),{selectedBusinessProfile:r,profileSource:"XLB_PROFILE_SYNC"};P("eats:xlb_sync_profile_xp_disabled",{profileUUID:m,profileType:D},e)}else P("eats:xlb_synced_profile_not_found",{profileUUID:m,profileType:D},e)}if(g){const e=v?.data?.find((e=>e?.uuid===g?.profileUUID));if(e){if(f())return P("eats:last_selected_profile_found",{profileType:e?.type,profileUUID:e?.uuid}),{selectedBusinessProfile:e,profileSource:"LAST_SELECTED_PROFILE"};P("eats:last_selected_profile_xp_disabled",{profileUUID:e?.uuid,profileType:e?.type})}else P("eats:last_selected_profile_not_found",{profileUUID:g?.profileUUID})}}return{}}),[v?.data,r,m,g,t,P,D,f]);return{selectedBusinessProfile:T,profileSource:C,defaultBusinessProfileUUID:h,paymentProfileUuidForSelectedProfile:T?y({selectedBusinessProfile:T,preferredPaymentProfileUuid:O}):null}}},31615:(e,r,t)=>{t.d(r,{Z:()=>x});var i=t(74369),a=t(89151),n=t(15070),o=t(98976),s=t(71576),l=t(24934),u=t(56993),d=t(92005),p=t(82600),c=t(70587),f=t(24316),y=t(53811),U=t(59738),P=t(44606),m=t(46008);var D=t(33535),I=t(19759),O=t(38777),b=t(35455),_=t(66316),g=t(34062),h=t(20568);var v=t(85427),T=t(34626),C=t(35291),S=t(36956),B=t(9485);const k=e=>{const r="createDraftOrderV2",t=(0,s.Z)(r,!0),l=(0,I.m6)(r),d=(0,D.ZP)(),{user:p}=(0,T.Z)(),c=p.data?.isLoggedIn,f=(0,n.v)((e=>{let{delegatedBooking:r}=e;return r})),U=(0,C.a)(),P=function(){const e=(0,g.E)(),r=(0,D.ZP)(),{updateDraftOrderV2:t}=(0,_.Z)(),{updateUseCredits:i}=(0,u.IM)(),{isDelegatedBooking:a}=(0,O.W)(),n=(0,h.Z)("getCheckoutPresentationV1",{continueOnUnmount:!0});return async o=>{if(e&&!a)try{const e=((await n({payloadTypes:["paymentProfilesEligibility"],draftOrderUUID:o.uuid}))?.checkoutPayloads?.paymentProfilesEligibility?.eligibilityPayloadList??[]).map((e=>e.isEligible?{paymentProfileUUID:e?.paymentProfileUUID}:void 0)).filter(Boolean);e.length>0&&(i(!1),await t({draftOrderUUID:o.uuid,extraPaymentProfiles:e,useCredits:!1}),r("eats:healthcare_eligible_order_created",{draftOrderUuid:o.uuid}))}catch(e){}}}(),m=(0,i.useCallback)(I.qO,[]),{handleXlbProfileCorrectionDisabling:b}=(0,B.k)(),v=(0,i.useCallback)((r=>{const i=t(r);return e?.(),i}),[t,e]),S=(0,a.useQueryClient)(),k=(0,i.useCallback)(((e,r)=>{d(l,m(r,c,f)),e?.cartsView&&S.setQueryData(y.x,e.cartsView),U.enqueue(e?.draftOrderPresentationResponse),e?.draftOrder&&(P(e.draftOrder),b(e.draftOrder))}),[d,l,m,c,f,U,S,P,b]),x=(0,i.useCallback)(((e,r)=>{d(l,{...m(r),error:e})}),[m,d,l]),V=(0,a.useMutation)(v,{onSuccess:k,onError:x});return{createDraftOrderMaybe:(0,o.rF)(V),createDraftOrderV2:V.mutateAsync}};function x(e,r,t){const{createDraftOrderV2:a,createDraftOrderMaybe:o}=k(r),{paymentProfileUuid:s}=(0,p.Z)(),{selectedPromotionUuid:y,skipApplyingPromotion:I}=(0,n.v)((e=>{let{checkout:r}=e;return r}))||{},{deliveryInstructions:_}=(0,l.pK)(),g=_.data?.selectedInstruction?.interactionType||_.data?.preferredInteractionType||v.$$.interactionType,h=(0,d.Z)(),{paymentIntent:T}=(0,u.IM)(),C="business"===T,{isInMulticart:B}=(0,f.Z)(),x=(0,D.ZP)(),V=(0,O.W)(),{selectedBusinessProfile:Z,profileSource:E,paymentProfileUuidForSelectedProfile:M}=(0,S.Z)();return{createDraftOrderMaybe:o,createDraftOrder:(0,i.useCallback)((async r=>{let{shoppingCartItems:i,isBandwagon:n,groupOrderStoreUUID:o,spendingLimit:l,currencyCode:u,businessDetails:d,billSplitOption:p,addParticipantsIntended:f,displayName:D,cartLockOptions:O,deliveryTime:_,actionMeta:v,promotionUuid:T,handledHighCapacityOrderMetadata:S,repeatOrderOptions:k,primaryDraftOrderUUID:L,draftOrderPresentationContext:q,deliveryType:F,addOnOfferContext:Q}=r;const A=T||y;let N={isMulticart:B,shoppingCartItems:i,useCredits:!0,extraPaymentProfiles:[],promotionOptions:{autoApplyPromotionUUIDs:[],selectedPromotionInstanceUUIDs:A?[A]:[],skipApplyingPromotion:I},deliveryTime:_,deliveryType:n?"BANDWAGON":"ASAP",groupOrderStoreUUID:o,spendingLimit:l,currencyCode:u,addParticipantsIntended:f,interactionType:g,paymentProfileUUID:s,billSplitOption:p,displayName:D,checkMultipleDraftOrdersCap:B,cartLockOptions:O,actionMeta:v,draftOrderPresentationContext:q,...L&&{createBundleGroup:{primaryDraftOrderUUID:L}},addOnOfferContext:Q};return F&&(N.deliveryType=F),Z?(N.businessDetails={profileType:Z?.type,profileUUID:Z?.uuid},N.paymentProfileUUID=M,N.analyticsRelevantData={profileSource:E}):d&&d.profileUUID?N.businessDetails={profileUUID:d.profileUUID,profileType:d.profileType,policyUUID:d.policyUUID,policyVersion:d.policyVersion,expenseCode:d.expenseCode,expenseMemo:d.expenseMemo,expenseTrip:d.expenseTrip,businessTrip:d.businessTrip,organizationUUID:d.organizationUUID,voucherUUID:d.voucherUUID,voucherPolicyVersion:d.voucherPolicyVersion}:N.businessDetails={},!C&&h?.voucherUUID&&p!==c.x.SPLIT_BY_SUBTOTAL&&(N.businessDetails.voucherPolicyVersion=h?.voucherData?.policy?.version,N.businessDetails.voucherUUID=h?.voucherUUID),S&&(N.handledHighCapacityOrderMetadata={hhcOrderSize:S.hhcOrderSize}),k&&(N.repeatSchedule=(0,U.OL)({repeatOrderOptions:k})),null!=i&&(N.shoppingCartItems=((e,r)=>e.map((e=>(e.itemQuantity?.inSellableUnit?.measurementUnit?.measurementType!==m.RV.MEASUREMENT_TYPE_COUNT||!e.itemQuantity.inSellableUnit||e.itemQuantity?.inSellableUnit?.value&&P.Tf.from(e.itemQuantity.inSellableUnit.value).toFloat()===e.quantity||(r&&r(e.itemQuantity),e.itemQuantity.inSellableUnit.value=P.Tf.from(e.quantity).toCoefficientDecimal()),e))))(i,(r=>{x("eats:create_draft_order_quantity_item_quantity_mismatch",{itemQuantity:JSON.stringify(r),source:e,request:JSON.stringify(N)})}))),"reorder"===e&&(N.shoppingCartItems=N.shoppingCartItems?.map((e=>({...e,itemQuantity:{...e.itemQuantity,inPriceableUnit:null}})))),V?.isDelegatedBooking&&(N=(0,b.yj)(N,V)),t&&(N.creationSurface=t),a(N)}),[B,a,g,C,s,T,y,h.voucherData?.policy?.version,h.voucherUUID,I])}}},34062:(e,r,t)=>{t.d(r,{E:()=>n});var i=t(60849),a=t(43426);function n(){return(0,i.ip)({...a.J.is_healthcare_card_enabled,defaultValue:!1})}}}]);