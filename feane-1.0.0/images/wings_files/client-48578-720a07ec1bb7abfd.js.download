"use strict";(self.webpackChunkFusion=self.webpackChunkFusion||[]).push([[48578],{66493:(e,t,s)=>{s.d(t,{Z:()=>f});var o=s(11137),i=s(74369),r=s(82744),n=s(58024),a=s(36262),d=s(93649),l=s(62322),u=s(59924);const c={border:"none"},p={display:"flex",flexDirection:"column",boxSizing:"border-box",justifyContent:"center"};function h(e){const t=typeof e;return"number"===t||"string"===t&&!!e}function m(e){const t=(0,a.UL)(o.window.innerHeight,o.window.innerWidth);return{height:h(e.height)?e.height:t.height,width:h(e.width)?e.width:t.width}}const g=/^(https?:\/\/[^/]+)\/.*$/i;function y(e){const t=g.exec(e);if(t)return t[1];throw Error("Bad `url` format")}const b=()=>{};class f extends i.Component{trackTiming=b;trackEvent=b;hiddenForm=null;popup={window:null,closeInterval:null};constructor(e){super(e);const t=function(e){const t={key:e.publishableKey,postOrigin:o.window.location.origin};return e.useCaseKey&&(t.useCaseKey=e.useCaseKey),e.options&&e.options.layout&&(t.layout=e.options.layout),e.options&&e.options.theme&&(t.theme=e.options.theme),e.organizationUuid&&(t.organizationUuid=e.organizationUuid),e.options&&e.options.context&&(t.ctx=JSON.stringify(e.options.context)),e.options&&e.options.role&&(t.role=e.options.role),e.options&&e.options.localeCode&&(t.localeCode=e.options.localeCode),e.redirectUrl&&(t.redirectUrl=e.redirectUrl),e.urlSearchParams&&Object.assign(t,{...e.urlSearchParams}),t}(e);this.state={paymentsHubUrl:(0,a.o3)(e.url,t),loading:!!e.load,failed:!1,isClient:!1},this.props.embedMode===n.j.redirect?this.targetName="_self":this.targetName=this.props.iframeName||"payments_hub"}handlePostMessage=e=>{const t=this.props?.options?.acceptableOrigins||[];if(a.Lz.concat(t).includes(e.origin)){const{resolutionHandler:t,load:s}=this.props;!this.readyTime&&this.state.loading&&s&&s.isLoaded(e.data)&&(this.trackEvent("ready"),this.readyTime=new Date,this.loadStartTime&&this.trackTiming("ready_time",this.loadStartTime),this.clearLoadTimer(),this.setState({loading:!1})),t(e.data)}};componentDidMount(){const e=new r.A({publishableKey:this.props.publishableKey,integrationName:this.props.integrationName||"unknown",embedMode:this.props.embedMode||"unknown",eventPrefix:this.props.analytics?.eventPrefix||"",origin:y(this.props.url),tags:this.props.analytics?.tags});if(this.tracker=e,this.trackTiming=e.trackTiming.bind(e),this.trackEvent=e.trackEvent.bind(e),this.trackEvent("mount"),this.setLoadTimer(),this.props.embedMode===n.j.redirect){if(!this.props.postParams||!this.hiddenForm)return o.window.location.assign(this.state.paymentsHubUrl)}else o.window.addEventListener("message",this.handlePostMessage);if(this.props.embedMode===n.j.popup){const e=this.props?.options?.styleOptions||{},{top:t,left:s,width:i,height:r}=function(e){const t=m(e),s=parseInt(t.width,10),i=parseInt(t.height,10);return{top:~~((o.window.outerHeight-i)/2)+(o.window.screenTop||o.window.screenY),left:~~((o.window.outerWidth-s)/2)+(o.window.screenLeft||o.window.screenX),...t}}(e);if(this.popup.window=o.window.open(this.props.postParams?"":this.state.paymentsHubUrl,this.targetName,`top=${t},left=${s},width=${i},height=${r},toolbar,location,status,resizable,scrollbars`),!this.popup.window)return this.props.resolutionHandler({resultCode:d.lw.openFailed});this.popup.closeInterval=setInterval((()=>{this.popup.window&&!this.popup.window.closed||this.props.resolutionHandler({resultCode:d.lw.closed})}),500)}this.props.postParams&&this.hiddenForm&&(0,l.tL)({publishableKey:this.props.publishableKey,integrationName:this.props.integrationName||"unknown",origin:y(this.props.url)}).then((()=>{this.hiddenForm&&this.hiddenForm.submit()})),this.setState((e=>({...e,isClient:!0})))}componentWillUnmount(){this.readyTime&&(this.trackTiming("unmount_time",this.readyTime),this.trackEvent("unmount")),this.loadStartTime&&(this.trackTiming("cancel_time",this.loadStartTime),this.trackEvent("cancel")),this.clearLoadTimer(),o.window.removeEventListener("message",this.handlePostMessage),this.props.embedMode===n.j.popup&&this.popup.window&&this.popup.window.close(),clearInterval(this.popup.closeInterval)}setLoadTimer(){this.loadStartTime=new Date,this.props.load&&this.props.load.timeout>0&&(this.loadTimer=setTimeout(this.onLoadTimeout,this.props.load.timeout))}clearLoadTimer(){this.loadStartTime=null,clearTimeout(this.loadTimer)}onLoadTimeout=()=>{this.trackEvent("load_timeout"),this.setState({failed:!0,loading:!1})};onRetry=()=>{this.trackEvent("retry"),this.setLoadTimer(),this.setState({failed:!1,loading:!0})};render(){const{load:e}=this.props,{loading:t,failed:s}=this.state;if(s&&e)return e.Error(this.onRetry);const o=this.props?.options?.styleOptions||{},i=m(o),r={...c,...o,width:t?0:"100%",height:t?0:"100%"},a=Object.assign({},p,i),d=this.props.title||"Uber - Payments";return(0,u.BX)("div",{"data-test":"payments-hub-container",style:a,children:[this.props.embedMode!==n.j.popup&&this.props.embedMode!==n.j.redirect&&(this.props.postParams||this.state.isClient)&&(0,u.tZ)("iframe",{src:this.props.postParams?void 0:this.state.paymentsHubUrl,style:r,title:d,name:this.targetName,allow:"clipboard-write; web-share"}),this.props.postParams&&(0,u.tZ)("form",{ref:e=>{this.hiddenForm=e},method:"POST",action:this.state.paymentsHubUrl,target:this.targetName,children:Object.keys(this.props.postParams).map((e=>(0,u.tZ)("input",{type:"hidden",name:e,value:this.props.postParams&&this.props.postParams[e]},e)))}),t&&e&&e.Loader()]})}}},58024:(e,t,s)=>{s.d(t,{j:()=>o});const o=Object.freeze({embedded:"embedded",popup:"popup",redirect:"redirect"})},93649:(e,t,s)=>{s.d(t,{IO:()=>l,a_:()=>d,lw:()=>n,yZ:()=>a});var o=s(58024),i=s(36262);const r=["apple_pay_display","google_pay"],n=Object.freeze({openFailed:"popup_open_failed",closed:"popup_closed"}),a={width:"100%",height:"100%"};function d(e){return!0===(0,i.Jp)(e)}function l(e){return e?.tokenType&&r.includes(e.tokenType)?o.j.popup:o.j.embedded}},10817:(e,t,s)=>{s.d(t,{Z:()=>a});var o=s(33535),i=s(55793),r=s(62459),n=s(48885);function a(){const e=(0,r.Z)("getPastOrdersV1"),t=(0,o.ZP)(),s=(0,i.m)(),a=(0,n.Z)();return async o=>{let i=0;try{const t=await e.request("getPastOrdersV1",{limit:1});t&&Array.isArray(t?.orderUuids)&&(i=t.orderUuids.length)}catch(e){}t("eats:place_order_success_client",{placeOrderSuccessClient:{...o,hasExistingOrders:i>0,...s?{entryPointData:s}:null,isFromRiderCarousel:a}})}}},47813:(e,t,s)=>{s.d(t,{ZP:()=>A,CS:()=>L});var o=s("__fusion__476"),i=s(75514),r=s(74369),n=s(80757),a=s(89151),d=s(69420),l=s(94813),u=s(15070),c=s(53308),p=s(47986),h=s(49201),m=s(24934),g=s(75782),y=s(64388),b=s(79526),f=s(58197),w=s(10817),k=s(27871),v=s(50818),T=s(69694),C=s(81219),P=s(70605),O=s(87696),_=s(92431),U=s(33535),Z=s(62459),E=s(70940);const S={firstName:"",lastName:"",phoneNumber:"",countryCode:"",countryDialCode:"",email:""};function I(){const e=(0,Z.Z)("createGuestOrdersByDraftOrdersV1"),{deliveryInstructions:t}=(0,r.useContext)(m.X3),s=t.data?.selectedInstruction,o=(0,f.Z)(),{storeUUID:I,cart:N}=(0,T.Z)()||{},{store:{data:x}}=(0,y.ZP)(I),L=(0,E.Z)(I||""),{draftOrderUuid:A}=(0,g.Z)(),{neutralZoneTimeOut:R}=(0,b.q)(),j=Boolean(x&&A),F=(0,l.TH)(),G=(0,d.k6)(),B=(0,w.Z)(),D=(0,k.B0)("total"),H=(0,k.B0)("subtotal"),{isSingleUseItemsIncluded:M}=(0,u.v)((e=>{let{checkout:t}=e;return t}))||{},z=(0,c.I0)(),q=(0,_.Z)(),K=(0,O.FH)(q),[V,$]=(0,r.useState)(S),[Y,W]=(0,r.useState)(void 0),[X,J]=(0,r.useState)(void 0),[Q,ee]=(0,r.useState)(!1),te=(0,U.ZP)(),se=(0,r.useCallback)((()=>{J(void 0),W(void 0)}),[J,W]),oe=(0,a.useMutation)((t=>e.request("createGuestOrdersByDraftOrdersV1",t)),{onSuccess:e=>{A&&x&&(B({orderUuid:A,store:(0,v.TG)(x),cartItems:N.data?.items||[],isGuestOrder:!0,isGuestOrderViaPaymentExpansion:!0,verticalLabel:L?"GROCERY":"RESTAURANT",fare:{total:Number((0,h.$I)(D.data?.total?.value.amountE5||0)),subTotal:Number((0,h.$I)(H.data?.subtotal?.value?.amountE5||0)),tax:0,discount:0,bookingFee:0}}),G.replace((0,p._u3)(F,{uuid:A})),(0,O.cX)(q),se(),z((0,C.yR)(A)),z((0,P.zc)()))}}),ie=(0,r.useCallback)((e=>{"checkoutActionsRequiredPayload"===e.meta?.payload?.type?(W(e.meta.payload.checkoutActionsRequiredPayload.checkoutActionParams),G.replace((0,p.vN_)((0,p.Zs0)(F),"checkoutActions"))):(te("eats:place_guest_order_click_error",{isGuestOrderViaPaymentExpansion:!0}),G.push((0,p.vN_)(F,"placeOrderError")))}),[W,G,F,te]),re=(0,r.useCallback)((()=>{if(!j||!x||!A)return null;const e={draftOrderUUID:A,...s?{dropoffInstructionUUID:s.instructionUuid,interactionType:s.interactionType}:null,...x.singleUseItemsInfo?{isSingleUseItemsIncluded:M}:null,shareCPFWithRestaurant:!1,checkoutActionResultParams:X,extraParams:{timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,trackingCode:o.get(),storeUuid:I,cityName:x.citySlug,isTealiumEnabled:Boolean(i.Z?.utag),isNeutralZoneEnabled:Boolean(R),verticalLabel:L?"GROCERY":"RESTAURANT",cookieConsent:Boolean(K)}};oe.mutate(e,{onError:ie})}),[oe,j,K,A,L,M,x,R,o,s,I,X,ie]),ne=(0,r.useCallback)((()=>{se(),G.push((0,p.vN_)(F,"checkoutActions"))}),[se,G,F]),ae=(0,r.useCallback)((()=>{ee(!0),G.replace((0,p.vN_)(F,"checkoutLoader"))}),[ee,G,F]);return(0,r.useEffect)((()=>{Q&&((0,n.flushSync)((()=>{ee(!1)})),te("eats:place_guest_order_click",{isGuestOrderViaPaymentExpansion:!0}),re())}),[re,Q,ee,te]),{checkoutEnabled:j,requestCheckoutActionsPayload:ne,createGuestOrder:ae,isPlacingGuestOrder:oe.isLoading,checkoutOrderActionParams:Y,setCheckoutOrderActionParams:W,checkoutActionResults:X,setCheckoutActionResults:J,isCreateGuestOrderEnqueued:Q,userInfo:V,setUserInfo:$}}var N=s(59924);const x=o.createContext(null);function L(){const e=o.useContext(x);if(null!==e)return e;throw Error("You should use useCreateGuesyOrderContext only in a descendant of CreateGuestOrderByDraftOrderProvider")}function A(e){return(0,N.tZ)(x.Provider,{value:{...I()},children:e.children})}},48885:(e,t,s)=>{s.d(t,{Z:()=>n});var o=s(2466),i=s(92431),r=s(29557);const n=()=>{const e=(0,o.Z)(),t=(0,i.Z)();if(!e)return!1;const s=e.get("emcSessionId"),n=t.get(r.Yg);return Boolean(s&&s===n)}},79526:(e,t,s)=>{s.d(t,{q:()=>c});var o=s("__fusion__476"),i=s(69420),r=s(68799),n=s(47986),a=s(60849),d=s(96881),l=s(83960),u=s(94813);function c(){const e=(0,u.TH)(),t=(0,i.k6)(),{isBillSplitParticipant:s}=(0,l.Z)(),c=(0,a.rj)({...d.s.enable_neutral_zone,defaultValue:6e3});return{neutralZone:o.useCallback((()=>{if(!c)return!1;const o=(0,r.Z7)("uev2.nz-completed")?.completed,i=!o&&!s;return i&&t.push((0,n.yhp)(e,{fromCheckout:!0})),i}),[c,s,t,e]),neutralZoneTimeOut:c}}}}]);