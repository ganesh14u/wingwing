"use strict";(self.webpackChunkFusion=self.webpackChunkFusion||[]).push([[3064],{3064:(e,s,t)=>{t.d(s,{_l:()=>M,ZP:()=>E});var o=t(74369),i=t(58024),n=t(53043),r=t(42545),a=t(11137),c=t("__fusion__476");const p=Object.freeze({needsDisplay:"checkoutactions_needs_display",componentNeedsDisplay:"component_needs_display",actionsComplete:"actions_complete",asyncActionsComplete:"async_actions_complete",switchPaymentMethod:"switch_payment_method",handleAction:"handle_action",invalidInputParams:"invalid_input_params",actionsError:"actions_error",userClosed:"user_closed"});var d=t(36262),u=t(93649),h=t(66493),l=t(63835);function m(e,s){try{return JSON.parse(e)}catch(e){return s}}const y=(e,s)=>{if(!e)return[];!function(e){const s=sessionStorage.getItem("checkoutSessionUUID");void 0!==s&&s!==e&&(sessionStorage.removeItem("actionResults"),sessionStorage.removeItem("checkoutSessionUUID"))}(s);const t=sessionStorage.getItem("actionResults"),o=t?JSON.parse(t):[];return o.push(...e),o};var P=t(59924);class S extends c.Component{state={dimensions:{height:0,width:0},isPreCheckoutSecondIteration:!1};checkoutSessionUUID=(0,l.Z)();constructor(e){super(e),e.dimensions&&(this.state.dimensions=e.dimensions),this.checkoutSessionUUID=(e=>{const s=(0,l.Z)();return e?.value&&m(e.value,{checkoutSessionUUID:s}).checkoutSessionUUID||s})(e.orderActionParams)}resolve=e=>{const{resultCode:s}=e;switch(e.resultCode){case p.componentNeedsDisplay:{const e=this.props.onNeedsDisplay;if(!e)return;const{height:s,width:t}=(0,d.UL)(a.window.innerHeight,a.window.innerWidth),o=e(s,t);return this.setState({dimensions:o})}case p.actionsComplete:const{actionResults:t}=e,o=!this.props.orderActionParams?.value&&!this.state.isPreCheckoutSecondIteration,i=!!this.props.orderActionParams?.value&&!this.state.isPreCheckoutSecondIteration;if(o)return function(e){e.embedMode&&sessionStorage.setItem("preCheckout_embedMode",e.embedMode),e.dimensions&&sessionStorage.setItem("preCheckout_dimensions",JSON.stringify(e.dimensions))}(this.props),this.props.onActionsComplete(t);if(i)return function(e,s){const t=m(e.value||"",{actionResults:[]}),o=y(t?.actionResults,s);sessionStorage.setItem("checkoutSessionUUID",s),sessionStorage.setItem("actionResults",JSON.stringify(o))}(t,this.checkoutSessionUUID),this.setState({key:JSON.stringify(this.props.orderActionParams),isPreCheckoutSecondIteration:!0});if(this.state.isPreCheckoutSecondIteration){const e=function(e,s){const t=m(e.value||"",{actionResults:[]}),o=y(t?.actionResults,s);return{value:JSON.stringify({...t??{},actionResults:o})}}(t,this.checkoutSessionUUID);return this.setState({isPreCheckoutSecondIteration:!1}),this.props.onActionsComplete(e)}return this.props.onActionsComplete(t);case p.asyncActionsComplete:const n=this.props.onAsyncActionsComplete;return n?n(s):this.props.onError(p.asyncActionsComplete);case p.switchPaymentMethod:return this.props.onSwitchPaymentMethod(e.paymentFlow);case p.handleAction:const r=this.props.onHandleAction;return r?r(e):this.props.onError(p.handleAction);case p.actionsError:case p.invalidInputParams:case u.lw.openFailed:return this.props.onError(s,e.message);case p.userClosed:case u.lw.closed:return this.props.onCancel(s)}};shouldHideLoader=e=>e&&e.resultCode===p.componentNeedsDisplay;resolutionHandler=e=>{this.resolve(e)};shouldComponentUpdate(e,s){return s.isPreCheckoutSecondIteration||!!e.orderActionParams&&JSON.stringify(this.props.orderActionParams)!==JSON.stringify(e.orderActionParams)}render(){let e=this.props.dimensions?this.props.dimensions:this.state.dimensions,s=this.props.embedMode;if(this.state.isPreCheckoutSecondIteration){const t=sessionStorage.getItem("preCheckout_dimensions"),o=sessionStorage.getItem("preCheckout_embedMode");e=t?JSON.parse(t):this.props.dimensions,s=o||this.props.embedMode}this.props.asyncOrderActionParams&&(e=u.yZ);const t=(0,d.t0)(this.props,e),o={checkoutSessionUUID:this.checkoutSessionUUID};this.props.guestUserUuid&&(o.guestUserUuid=this.props.guestUserUuid),this.props.jobUuid&&(o.jobUuid=this.props.jobUuid),this.props.location&&(o.location=JSON.stringify(this.props.location));const n={};if(this.props.paymentProfile&&(n.paymentProfile=JSON.stringify(this.props.paymentProfile)),this.props.estimatedPaymentPlan&&(n.estimatedPaymentPlan=JSON.stringify(this.props.estimatedPaymentPlan)),this.state.isPreCheckoutSecondIteration?n.orderActionParams="":this.props.orderActionParams&&(n.orderActionParams=JSON.stringify(this.props.orderActionParams)),this.props.asyncOrderActionParams){const e=this.props.asyncOrderActionParams.value,t=JSON.stringify(m(e||"",void 0));n.asyncOrderActionParams=JSON.stringify({value:t}),s=i.j.embedded}if(this.props.orderActionParams){const e=this.props.orderActionParams.value,s=JSON.stringify(m(e||"",void 0));s&&(n.orderActionParams=JSON.stringify({value:s}))}this.props.summaryItems&&(n.summaryItems=JSON.stringify(this.props.summaryItems)),this.props.guestSession&&(n.guestSession=JSON.stringify(this.props.guestSession)),this.props.orderContext&&(n.orderContext=JSON.stringify(this.props.orderContext)),this.props.businessProfileParameters&&(n.businessProfileParameters=JSON.stringify(this.props.businessProfileParameters));const r=(0,d.XQ)(this.props.origin),a=(0,d.pT)(this.props,"checkoutactions"),c=(0,d.DZ)(this.props,this.shouldHideLoader),p=this.props.title||"Uber - Modular Checkout";return(0,P.tZ)(h.Z,{resolutionHandler:this.resolutionHandler,publishableKey:this.props.publishableKey,useCaseKey:this.props.useCaseKey,integrationName:this.props.integrationName,embedMode:s,redirectUrl:this.props.redirectUrl,options:t,organizationUuid:this.props.organizationUuid,urlSearchParams:o,postParams:n,url:r,analytics:a,load:c,title:p},this.state.key)}}var g=t(79620),f=t(60849),C=t(46933),A=t(65602),U=t(95818),_=t(19972),b=t(65478),O=t(22065),k=t(37649),I=t(85293),N=t(93553),v=t(15649),Z=t(94579),w=t(230),D=t(65717),J=t(5639);const M=Object.freeze({REMOVE_PROMO:"remove_promo",REMOVE_SELECT_PROMO:"remove_select_promo"});function E(e){const s=(0,v.Z)(),t=(0,O.Z)(),a=(0,_.Z)(),c=(0,b.Z)(),p=(0,U.Z)(),d=function(e,s){const t=(0,f.F2)(),o=(0,w.Z)(),{isIOS:a}=(0,J.hU)();if((0,D.Z)())return i.j.embedded;if(o){if(e.tokenType===n.n.GOOGLE_PAY)return i.j.embedded;if(a&&t.getBoolean({...g.S.eats_ewf_checkout_actions_ios_force_popup,defaultValue:!1}))return s?i.j.popup:r.op.getEmbedMode(e);if(e.tokenType===n.n.APPLE_PAY&&t.getBoolean({...g.S.eats_ewf_apple_pay_display_popup,defaultValue:!1}))return i.j.embedded}return s?i.j.embedded:r.op.getEmbedMode(e)}(e.selectedPaymentProfile,e.orderActionParams),[h,l]=o.useState(!1),[m,y]=o.useState(!1),M="popup"===d?{width:Z.wO,height:Z.hy}:{width:"100%",height:"100%"},E={title:(0,P.tZ)(C.v,{id:"checkout.popup.failed.open.error.title"}),message:(0,P.tZ)(C.v,{id:"checkout.popup.failed.open.error.message"}),buttonText:(0,P.tZ)(C.v,{id:"checkout.popup.failed.open.button.text"})},{estimatedPaymentPlan:R}=e;return h?(0,P.tZ)(I.Z,{title:m?E.title:null,message:m?E.message:null,buttonText:m?E.buttonText:null,onRetry:()=>{l(!1),y(!1),e.onNeedsDisplay(!0)}}):(0,P.BX)(P.HY,{children:[(0,P.tZ)(k.Z,{eventName:"eats:payments_hub_start",eventPayload:{paymentsHubStart:{type:"checkout-actions"}}}),(0,P.tZ)(S,{asyncOrderActionParams:e.asyncOrderActionParams,orderActionParams:e.orderActionParams,jobUuid:e.jobUuid,estimatedPaymentPlan:R,guestUserUuid:e.unregisteredUserUuid,force3DS:e.force3DS,businessProfileParameters:e.businessProfileParameters,onNeedsDisplay:(s,t)=>(e.onNeedsDisplay(0===s&&0===t),{height:s,width:t}),onCancel:e.onCancel,onError:s=>{s===u.lw.openFailed&&y(!0),l(!0),e.onNeedsDisplay(!1)},onActionsComplete:e.onActionsComplete,onAsyncActionsComplete:e.onAsyncActionsComplete,onSwitchPaymentMethod:e.onSwitchPaymentMethod,onHandleAction:e.onHandleAction,loadTimeout:A.Ej,Loader:()=>(0,P.tZ)(N.Z,{isLoaderOnly:!0}),LoadError:e=>(0,P.tZ)(I.Z,{onRetry:e}),acceptableOrigins:p,context:e.context,origin:t,dimensions:M,publishableKey:a,useCaseKey:e.useCaseKey,integrationName:c,localeCode:s,guestSession:e.guestSession,embedMode:d})]})}}}]);